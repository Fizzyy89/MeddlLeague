<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Landratsamt Puzzle League</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Chakra+Petch:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/themes.css">
  <link rel="stylesheet" href="css/animations.css">
</head>
<body>
  <audio id="bgMusic" loop>
    <source src="music/menu.mp3" type="audio/mpeg">
  </audio>

  <div class="particles">
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
  </div>

  <div class="bouncing-emoji-container">
    <div class="bouncing-emoji">üî•</div>
    <div class="bouncing-emoji">üíß</div>
    <div class="bouncing-emoji">üçÄ</div>
    <div class="bouncing-emoji">‚ö°</div>
    <div class="bouncing-emoji">üåÄ</div>
  </div>

  <div class="logo">
    DR.ROHRs<br>
    MEDDLLEAGUE
  </div>

  <div class="menu">
    <a href="game.html?mode=solo" class="menu-item">Play Solo</a>
    <a href="game.html?mode=vs-ai" class="menu-item">Play VS. Computer (ALPHA)</a>
    <a href="canvas-game.html" class="menu-item">Canvas Mode (BETA)</a>
    <button class="menu-item" onclick="document.getElementById('optionsModal').classList.add('show')">Options</button>
    <button class="menu-item" onclick="document.getElementById('highScoresModal').classList.add('show')">High Scores</button>
  </div>

  <div id="volumeControl">
    <button id="muteBtn">üîä</button>
    <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="0.3">
  </div>

  <div id="optionsModal" class="modal-overlay">
    <div class="options-layout">
      <div class="options-container">
        <button class="close-modal">√ó</button>
        <h1 class="options-title">OPTIONS</h1>

        <div class="options-grid">
          <div class="options-column">
            <div class="option-group speed-section">
              <h2>INITIAL SPEED</h2>
              <div class="difficulty-display">
                <div class="difficulty-level" id="speedText">NORMAL</div>
                <div class="difficulty-number" id="speedValue">3</div>
              </div>
              
              <div class="slider-container">
                <input type="range" 
                       id="speedSlider" 
                       min="1" 
                       max="50" 
                       step="1" 
                       value="3">
                <div class="slider-markers">
                  <span>1</span>
                  <span>10</span>
                  <span>20</span>
                  <span>30</span>
                  <span>40</span>
                  <span>50</span>
                </div>
              </div>
            </div>

        <div class="option-group difficulty-section">
          <h2>DIFFICULTY</h2>
          <div class="difficulty-display">
                <div class="difficulty-level" id="difficultyText">NORMAL</div>
          </div>
          
          <div class="slider-container">
            <input type="range" 
                   id="difficultySlider" 
                       min="0" 
                       max="4" 
                   step="1" 
                       value="2">
            <div class="slider-markers">
                  <span>V.EASY</span>
                  <span>EASY</span>
                  <span>NORMAL</span>
                  <span>HARD</span>
                  <span>V.HARD</span>
                </div>
              </div>
            </div>
          </div>

          <div class="options-column">
            <div class="option-group audio-section">
              <h2>AUDIO</h2>
              <div class="volume-control">
                <div class="volume-group">
                  <label for="masterVolume">
                    <span class="volume-label">MASTER</span>
                    <button class="mute-btn" id="masterMuteBtn">üîä</button>
                  </label>
                  <input type="range" id="masterVolume" min="0" max="1" step="0.1" value="0.3">
                </div>
                <div class="volume-group">
                  <label for="musicVolume">
                    <span class="volume-label">MUSIC</span>
                    <button class="mute-btn" id="musicMuteBtn">üîä</button>
                  </label>
                  <input type="range" id="musicVolume" min="0" max="1" step="0.1" value="0.8">
                </div>
                <div class="volume-group">
                  <label for="sfxVolume">
                    <span class="volume-label">SOUND FX</span>
                    <button class="mute-btn" id="sfxMuteBtn">üîä</button>
                  </label>
                  <input type="range" id="sfxVolume" min="0" max="1" step="0.1" value="0.8">
                </div>
                <div class="checkbox-option">
                  <label for="useAltPopSound">
                    <input type="checkbox" id="useAltPopSound">
                    Use 'Dick' pop sound
                  </label>
                </div>
              </div>
            </div>

            <div class="option-group look-feel-section">
              <h2>LOOK & FEEL</h2>
              <div class="theme-option">
                <label for="themeSelectOptions">THEME</label>
                <div class="theme-preview" id="themePreview">
                    <span class="preview-block">üî•</span>
                    <span class="preview-block">üíß</span>
                    <span class="preview-block">üçÄ</span>
                    <span class="preview-block">‚ö°</span>
                    <span class="preview-block">üåÄ</span>
                </div>
                <select id="themeSelectOptions">
                  <option value="theme-elements">Elements Theme</option>
                  <option value="theme-animals">Farm Animals</option>
                  <option value="theme-retro">Retro Gaming</option>
                  <option value="theme-space">Space Theme</option>
                  <option value="theme-food">Food Theme</option>
                  <option value="theme-weather">Weather Theme</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <button id="saveOptions" class="save-button">SAVE CHANGES</button>
      </div>
    </div>
  </div>

  <div id="highScoresModal" class="modal-overlay">
    <div class="high-scores-layout">
      <div class="high-scores-container">
        <button class="close-modal">√ó</button>
        <h1 class="high-scores-title">HIGH SCORES</h1>
        
        <div class="scores-grid">
          <!-- Scores will be populated by JavaScript -->
        </div>

        <button id="resetScores" class="reset-button">RESET ALL SCORES</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { audioManager } from './js/audio.js';
    
    const bgMusic = document.getElementById('bgMusic');
    const volumeSlider = document.getElementById('volumeSlider');
    const muteBtn = document.getElementById('muteBtn');
    
    // Options Modal Elements
    const optionsModal = document.getElementById('optionsModal');
    const closeModalBtns = document.querySelectorAll('.close-modal');
    const speedSlider = document.getElementById('speedSlider');
    const speedValue = document.getElementById('speedValue');
    const difficultySlider = document.getElementById('difficultySlider');
    const saveButton = document.getElementById('saveOptions');
    
    // Audio Controls
    const masterVolumeSlider = document.getElementById('masterVolume');
    const musicVolumeSlider = document.getElementById('musicVolume');
    const sfxVolumeSlider = document.getElementById('sfxVolume');
    const masterMuteBtn = document.getElementById('masterMuteBtn');
    const musicMuteBtn = document.getElementById('musicMuteBtn');
    const sfxMuteBtn = document.getElementById('sfxMuteBtn');

    // Speed settings
    const speedLabels = {
      1: 'VERY SLOW',
      5: 'SLOW',
      10: 'NORMAL',
      20: 'FAST',
      30: 'VERY FAST',
      40: 'SUPER FAST',
      50: 'NIGHTMARE'
    };

    const speedColors = {
      1: '#90EE90',  // light green
      5: '#90EE90',  // light green
      10: '#32CD32', // green
      20: '#FFD700', // yellow
      30: '#FFA500', // orange
      40: '#FF4444', // red
      50: '#CC0000'  // dark red
    };
    
    // Difficulty settings
    const difficulties = ['very-easy', 'easy', 'normal', 'hard', 'very-hard'];
    const difficultyColors = {
      'very-easy': '#90EE90',  // light green
      'easy': '#32CD32',       // green
      'normal': '#FFD700',     // yellow
      'hard': '#FF4444',       // red
      'very-hard': '#CC0000'   // dark red
    };

    // Function to get closest speed key for labels and colors
    function getClosestSpeedKey(speed) {
      return Object.keys(speedLabels)
        .map(Number)
        .reduce((a, b) => {
          return Math.abs(b - speed) < Math.abs(a - speed) ? b : a;
        });
    }

    // Function to get speed text based on current speed
    function getSpeedText(speed) {
      const closestKey = getClosestSpeedKey(speed);
      return speedLabels[closestKey];
    }

    // Load saved settings
    const savedVolume = localStorage.getItem('volume') || 0.3;
    const savedMuted = localStorage.getItem('muted') === 'true';
    const savedSpeed = localStorage.getItem('gameSpeed') || '3';
    const savedDifficulty = localStorage.getItem('gameDifficulty') || 'normal';
    
    // Initial setup
    bgMusic.volume = savedVolume;
    bgMusic.muted = savedMuted;
    volumeSlider.value = savedVolume;
    muteBtn.textContent = savedMuted ? 'üîá' : 'üîä';
    speedSlider.value = savedSpeed;
    speedValue.textContent = savedSpeed;
    
    // Get speed text element
    const speedText = document.getElementById('speedText');
    
    // Set initial speed text and color
    if (speedText) {
      speedText.textContent = getSpeedText(parseInt(savedSpeed));
      speedText.style.color = speedColors[getClosestSpeedKey(parseInt(savedSpeed))];
    }
    
    // Set initial difficulty button
    difficultySlider.value = difficulties.indexOf(savedDifficulty);
    
    // Update initial difficulty text and color
    const difficultyText = document.getElementById('difficultyText');
    difficultyText.textContent = savedDifficulty.toUpperCase().replace('-', ' ');
    difficultyText.style.color = difficultyColors[savedDifficulty];
    difficultySlider.style.setProperty('--slider-color', difficultyColors[savedDifficulty]);

    // Close button functionality
    closeModalBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        btn.closest('.modal-overlay').classList.remove('show');
      });
    });

    // Close on outside click
    optionsModal.addEventListener('click', (e) => {
      if (e.target === optionsModal) {
        optionsModal.classList.remove('show');
      }
    });

    // Close on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        document.querySelectorAll('.modal-overlay').forEach(modal => {
          modal.classList.remove('show');
        });
      }
    });

    // Difficulty Controls
    difficultySlider.addEventListener('input', (e) => {
      const index = parseInt(e.target.value);
      const difficulty = difficulties[index];
      const color = difficultyColors[difficulty];
      
      // Update difficulty text and color
      difficultyText.textContent = difficulty.toUpperCase().replace('-', ' ');
      difficultyText.style.color = color;
      difficultySlider.style.setProperty('--slider-color', color);
    });

    // Speed Controls
    speedSlider.addEventListener('input', (e) => {
      const speed = parseInt(e.target.value);
      const closestKey = getClosestSpeedKey(speed);
      
      // Update speed value
      speedValue.textContent = speed;
      speedValue.style.color = speedColors[closestKey];
      
      // Update speed text
      if (speedText) {
        speedText.textContent = speedLabels[closestKey];
        speedText.style.color = speedColors[closestKey];
      }
      
      // Update slider color
      speedSlider.style.setProperty('--slider-color', speedColors[closestKey]);
    });

    // Save Button
    saveButton.addEventListener('click', () => {
      const selectedDifficulty = difficulties[parseInt(difficultySlider.value)];
      const selectedSpeed = parseInt(speedSlider.value);
      const useAltPopSound = document.getElementById('useAltPopSound').checked;
      
      localStorage.setItem('gameSpeed', selectedSpeed);
      localStorage.setItem('gameDifficulty', selectedDifficulty);
      localStorage.setItem('useAltPopSound', useAltPopSound);
      audioManager.useAltPopSound = useAltPopSound;
      
      // Show save confirmation
      saveButton.textContent = 'Saved!';
      saveButton.classList.add('saved');
      
      setTimeout(() => {
        saveButton.textContent = 'SAVE CHANGES';
        saveButton.classList.remove('saved');
      }, 1500);
    });
    
    // Volume Controls
    volumeSlider.addEventListener('input', (e) => {
      const newVolume = e.target.value;
      bgMusic.volume = newVolume;
      localStorage.setItem('volume', newVolume);
      muteBtn.textContent = newVolume === '0' ? 'üîá' : 'üîä';
    });

    muteBtn.addEventListener('click', () => {
      bgMusic.muted = !bgMusic.muted;
      localStorage.setItem('muted', bgMusic.muted);
      muteBtn.textContent = bgMusic.muted ? 'üîá' : 'üîä';
    });

    // Start music after first interaction
    document.addEventListener('click', function initAudio() {
      audioManager.bgMusic.play().catch(console.error);
      document.removeEventListener('click', initAudio);
    }, { once: true });

    // High scores handling
    const highScoresModal = document.getElementById('highScoresModal');
    const closeHighScoresBtn = highScoresModal.querySelector('.close-modal');
    const scoresGrid = document.querySelector('.scores-grid');
    const resetScoresBtn = document.getElementById('resetScores');

    // Function to reset all high scores
    function resetHighScores() {
        if (confirm('Are you sure you want to reset all high scores? This cannot be undone.')) {
            difficulties.forEach(difficulty => {
                localStorage.removeItem(`highScore_${difficulty}`);
            });
            updateHighScoresDisplay();
        }
    }

    // Add reset button event listener
    resetScoresBtn.addEventListener('click', resetHighScores);

    // Function to update high scores display
    function updateHighScoresDisplay() {
        scoresGrid.innerHTML = '';
        
        // Create header
        const header = document.createElement('div');
        header.className = 'scores-header';
        header.innerHTML = `
            <div class="difficulty-column">DIFFICULTY</div>
            <div class="score-column">HIGH SCORE</div>
        `;
        scoresGrid.appendChild(header);
        
        // Add scores for each difficulty
        difficulties.forEach(difficulty => {
            const score = localStorage.getItem(`highScore_${difficulty}`) || '0';
            const color = difficultyColors[difficulty];
            
            const scoreEntry = document.createElement('div');
            scoreEntry.className = 'score-entry';
            
            scoreEntry.innerHTML = `
                <div class="difficulty-column" style="color: ${color}">
                    ${difficulty.toUpperCase().replace('-', ' ')}
                </div>
                <div class="score-column">
                    ${score}
                </div>
            `;
            
            scoresGrid.appendChild(scoreEntry);
        });
    }

    // Update high scores when opening modal
    document.querySelector('.menu-item[onclick*="highScoresModal"]').addEventListener('click', updateHighScoresDisplay);

    // Close high scores modal
    closeHighScoresBtn.addEventListener('click', () => {
      highScoresModal.classList.remove('show');
    });

    // Close on outside click
    highScoresModal.addEventListener('click', (e) => {
      if (e.target === highScoresModal) {
        highScoresModal.classList.remove('show');
      }
    });

    // Add some CSS styles for the high scores grid
    const style = document.createElement('style');
    style.textContent = `
        .scores-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 20px;
            font-family: 'Press Start 2P', cursive;
            max-width: 600px;
            margin: 0 auto;
        }

        .scores-header {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 2px solid #fff;
            margin-bottom: 10px;
        }

        .score-entry {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .score-entry:hover {
            transform: scale(1.02);
            box-shadow: 0 0 15px rgba(255, 217, 61, 0.2);
        }

        .difficulty-column {
            flex: 2;
            text-align: left;
        }

        .score-column {
            flex: 1;
            text-align: right;
        }

        .theme-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .theme-option label {
            font-family: 'Press Start 2P', cursive;
            color: #fff;
            font-size: 0.8rem;
        }

        .theme-preview {
            display: flex;
            gap: 5px;
            margin: 10px 0;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .preview-block {
            font-size: 24px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            transition: transform 0.2s;
        }

        .preview-block:hover {
            transform: scale(1.1);
        }

        #themeSelectOptions {
            width: 100%;
            padding: 8px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: #fff;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        #themeSelectOptions:hover {
            background: rgba(0, 0, 0, 0.4);
            border-color: rgba(255, 255, 255, 0.2);
        }

        #themeSelectOptions option {
            background: #1a1a1a;
            color: #fff;
            padding: 8px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .options-column {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .option-group {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 8px;
            margin: 0;
        }

        .option-group h2 {
            margin: 0 0 20px 0;
            text-align: center;
            font-family: 'Press Start 2P', cursive;
            font-size: 1rem;
            color: #fff;
        }

        .volume-control {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .volume-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .volume-control .checkbox-option {
            margin-top: 5px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
        }

        @media (max-width: 768px) {
            .options-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .options-column {
                gap: 20px;
            }

            .option-group {
                padding: 15px;
            }
        }
    `;
    document.head.appendChild(style);

    // Initialize audio controls
    masterVolumeSlider.value = audioManager.masterVolume;
    musicVolumeSlider.value = audioManager.musicVolume;
    sfxVolumeSlider.value = audioManager.sfxVolume;
    masterMuteBtn.textContent = audioManager.masterVolume === 0 ? 'üîá' : 'üîä';
    musicMuteBtn.textContent = audioManager.musicMuted ? 'üîá' : 'üîä';
    sfxMuteBtn.textContent = audioManager.sfxMuted ? 'üîá' : 'üîä';
    masterMuteBtn.classList.toggle('muted', audioManager.masterVolume === 0);
    musicMuteBtn.classList.toggle('muted', audioManager.musicMuted);
    sfxMuteBtn.classList.toggle('muted', audioManager.sfxMuted);

    // Set initial state of useAltPopSound checkbox
    const useAltPopSoundCheckbox = document.getElementById('useAltPopSound');
    useAltPopSoundCheckbox.checked = audioManager.useAltPopSound;

    // Add sound preview when toggling the checkbox
    useAltPopSoundCheckbox.addEventListener('change', (e) => {
        // Play the corresponding sound based on the new state
        if (e.target.checked) {
            audioManager.playSound('altPop');
        } else {
            audioManager.playSound('pop');
        }
    });

    // Audio control event listeners
    masterVolumeSlider.addEventListener('input', (e) => {
        const volume = parseFloat(e.target.value);
        audioManager.setMasterVolume(volume);
        masterMuteBtn.textContent = volume === 0 ? 'üîá' : 'üîä';
        masterMuteBtn.classList.toggle('muted', volume === 0);
        
        // Update the game's volume slider if it exists
        const gameVolumeSlider = document.getElementById('volumeSlider');
        if (gameVolumeSlider) {
            gameVolumeSlider.value = volume;
        }
    });

    musicVolumeSlider.addEventListener('input', (e) => {
        audioManager.setMusicVolume(parseFloat(e.target.value));
    });

    sfxVolumeSlider.addEventListener('input', (e) => {
        audioManager.setSFXVolume(parseFloat(e.target.value));
    });

    masterMuteBtn.addEventListener('click', () => {
        const newVolume = audioManager.masterVolume === 0 ? 0.3 : 0;
        audioManager.setMasterVolume(newVolume);
        masterVolumeSlider.value = newVolume;
        masterMuteBtn.textContent = newVolume === 0 ? 'üîá' : 'üîä';
        masterMuteBtn.classList.toggle('muted', newVolume === 0);
    });

    musicMuteBtn.addEventListener('click', () => {
        const isMuted = audioManager.toggleMusicMute();
        musicMuteBtn.textContent = isMuted ? 'üîá' : 'üîä';
        musicMuteBtn.classList.toggle('muted', isMuted);
    });

    sfxMuteBtn.addEventListener('click', () => {
        const isMuted = audioManager.toggleSFXMute();
        sfxMuteBtn.textContent = isMuted ? 'üîá' : 'üîä';
        sfxMuteBtn.classList.toggle('muted', isMuted);
    });

    // Theme mappings
    const themeSymbols = {
        'theme-elements': ['üî•', 'üíß', 'üçÄ', '‚ö°', 'üåÄ'],
        'theme-animals': ['üêÆ', 'üêë', 'üê∑', 'üêî', 'üê¥'],
        'theme-retro': ['‚ô•', '‚óÜ', '‚òÖ', '‚óè', '‚ñ≤'],
        'theme-space': ['üõ∏', '‚≠ê', 'üëæ', '‚òÑÔ∏è', 'ü™ê'],
        'theme-food': ['üçì', 'ü´ê', 'ü•ë', 'üçå', 'üçá'],
        'theme-weather': ['üåÖ', 'üåà', 'üå±', '‚òÄÔ∏è', '‚ö°']
    };

    // Theme colors for each block
    const themeColors = {
        'theme-elements': ['#FF4D00', '#00B4D8', '#00CC6A', '#FFD700', '#6D28D9'],
        'theme-animals': ['#D35D47', '#88B5D3', '#A4C3A2', '#ECD279', '#B784A7'],
        'theme-retro': ['#E74858', '#209CEE', '#92CC41', '#F7D51D', '#A374C6'],
        'theme-space': ['#FF1E39', '#00DDFF', '#00FFA3', '#FFB700', '#B026FF'],
        'theme-food': ['#FF6B6B', '#73C2FB', '#98FF98', '#FFD700', '#E0B0FF'],
        'theme-weather': ['#FF7E67', '#4FB4FF', '#7ED957', '#FFD93D', '#9D4EDD']
    };

    // Function to update preview blocks
    function updateThemePreview(theme) {
        const previewBlocks = document.querySelectorAll('#themePreview .preview-block');
        const symbols = themeSymbols[theme];
        const colors = themeColors[theme];
        
        previewBlocks.forEach((block, index) => {
            block.textContent = symbols[index];
            block.style.backgroundColor = colors[index];
            block.style.boxShadow = `0 0 10px ${colors[index]}40`; // Add subtle glow
            // Ensure emoji is visible on colored background
            block.style.textShadow = '2px 2px 4px rgba(0,0,0,0.5)';
        });
    }

    // Update the CSS for preview blocks
    const previewStyles = document.createElement('style');
    previewStyles.textContent = `
        .preview-block {
            font-size: 24px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.3s ease;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .preview-block:hover {
            transform: scale(1.1);
            filter: brightness(1.2);
        }

        .theme-preview {
            display: flex;
            gap: 5px;
            margin: 10px 0;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
    `;
    document.head.appendChild(previewStyles);

    // Load saved theme and update preview
    const savedTheme = localStorage.getItem('selectedTheme') || 'theme-elements';
    themeSelectOptions.value = savedTheme;
    updateThemePreview(savedTheme);

    // Update preview when theme changes
    themeSelectOptions.addEventListener('change', (e) => {
        const newTheme = e.target.value;
        updateThemePreview(newTheme);
        
        // Update the theme select in the game's info box if it exists
        const gameThemeSelect = document.getElementById('themeSelect');
        if (gameThemeSelect) {
            gameThemeSelect.value = newTheme;
            // Trigger the change event on the game's theme select
            gameThemeSelect.dispatchEvent(new Event('change'));
        } else {
            // If we're not in the game, just update theme directly
            audioManager.updateThemeMusic(newTheme);
            localStorage.setItem('selectedTheme', newTheme);
            document.body.className = newTheme;
        }
    });

    themeSelect.addEventListener('change', (e) => {
        const newTheme = e.target.value;
        themeSelectOptions.value = newTheme;
        updateThemePreview(newTheme);
        audioManager.updateThemeMusic(newTheme);
        localStorage.setItem('selectedTheme', newTheme);
        document.body.className = newTheme;
    });

    // Update the CSS for the checkbox in the audio section
    const audioStyles = document.createElement('style');
    audioStyles.textContent = `
        .volume-control .checkbox-option {
            margin-top: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
        }

        .volume-control .checkbox-option label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.7rem;
            color: #fff;
            cursor: pointer;
        }

        .volume-control .checkbox-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
    `;
    document.head.appendChild(audioStyles);
  </script>
</body>
</html> 